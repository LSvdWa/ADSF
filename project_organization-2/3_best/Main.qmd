---
title: "Main"
format: html
---

```{r}
setwd(".")

# install.packages("pairsD3")
require("pairsD3")
```

------------------------------------------------------------------------

1.  **Preliminaries:** Introduction of your research questions, description and potential processing of your data.

------------------------------------------------------------------------

```{r}
# Load .CSV and save as .RDS

datacsv <- read.csv("./data/raw/diabetes.csv", header = TRUE)
saveRDS(datacsv, "./data/raw/dataset.rds")

# Preprocessing
dataRDS <- readRDS("./data/raw/dataset.rds")
dataRDS <- na.omit(dataRDS) # removes NA from important columns
saveRDS(dataRDS, "./data/processed/dataset.rds")
dataset <- readRDS("./data/processed/dataset.rds")

# Recoding BMI to classes
dataRDS$BMI[dataRDS$BMI <= 18.5 ] <- 1
dataRDS$BMI[dataRDS$BMI > 18.5 & dataRDS$BMI <= 25  ] <- 2
dataRDS$BMI[dataRDS$BMI > 25 & dataRDS$BMI <= 30 ] <- 3
dataRDS$BMI[dataRDS$BMI > 30] <- 4

# Adding moderation
dataRDS$moderation <- dataRDS$BMI * dataRDS$Insulin * dataRDS$SkinThickness * (dataRDS$BloodPressure) 

summary(dataset)
```

1.  **Model estimation:** Description of the model estimates, model fit, and model comparison procedure (including moderation)

```{r}

dataRDS
#shinypairs(dataRDS)

pairs(dataRDS)

model <- lm(Glucose ~ Age + Insulin + BMI + Pregnancies + BloodPressure + SkinThickness + DiabetesPedigreeFunction + moderation, 
             data = dataRDS)
model2 <- lm(Glucose ~ Age + Insulin + BMI + SkinThickness + moderation + DiabetesPedigreeFunction, 
             data = dataRDS)
model3 <- lm(Glucose ~ Age + Insulin + BMI + SkinThickness + moderation, 
             data = dataRDS)

# Ask for summary statistics again
summary(model)
summary(model2)
summary(model3)

anova(model, model2, model3)

library(ggplot2)

# Plot with regression line for x1
ggplot(dataRDS, aes(x = Age, y = Glucose)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) + # se = FALSE to hide confidence interval
  labs(title = "Relationship between Age and Glucose")

# Plot with regression line for x2
ggplot(dataRDS, aes(x = Insulin, y = Glucose)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "Relationship between {Insulin} and Glucose")

# Plot with regression line for x1
ggplot(dataRDS, aes(x = SkinThickness, y = Glucose)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) + # se = FALSE to hide confidence interval
  labs(title = "Relationship between Age and Glucose")

# Plot with regression line for x2
ggplot(dataRDS, aes(x = BMI, y = Glucose)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "Relationship between {BMI} and Glucose")

# Plot with regression line for x2
ggplot(dataRDS, aes(x = moderation, y = Glucose)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "Relationship between {Moderation} and Glucose")


```

1.  **Assumptions:** Testing of model assumptions, checking for influential cases. Act upon and/or reflect on violations when needed.

```{r}
# Assumptions are: linearity, Exogenous predictors, constant finite error variance Predictor matrix full rank, independent errors, normal distributed errors.
```

1.  **Interpretation:** Substantive interpretation of the final model. Answering your research question.

```{r}

```

1.  **Layout:** Structure of the document, efficiency of output presentation, use of custom functions (when applicable). Presentation of suitable visualizations.

```{r}

```

1.  **Coding:** Use code from the labs and annotate what each piece of code does.
