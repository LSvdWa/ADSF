------------------------------------------------------------------------

**Prediction of glucose using linear regression.**

Demi van den Biggelaar (9660089)\
August Gesthuizen (?)\
Friso Harff (7526946)\
Leander van der Waal (7180063)\

**Introduction**

<<<<<<< Updated upstream
1 in 14 Dutch citizens has diabetes (Cijfers Over Diabetes, z.d.). To treat diabetes more effectively and to prevent serious complications it is crucial to diagnose it as early as possible. Having diabetes means that there is a shortage of insulin in the body, causing glucose to stay in the blood instead, which can cause a range of complications (Umcu, z.d.). Diabetes can be diagnosed by measuring the plasma glucose concentration in the blood (Diabetes Mellitus Type 2 \| LUMC, z.d.). To diagnose diabetes faster we want to know if we can predict glucose levels based on other parameters.
=======
1 in 14 Dutch citizens has diabetes (Cijfers Over Diabetes, z.d.). To treat diabetes more effective and to prevent serious complications it is crucial to diagnose it as early as possible. Having diabetes means that there is a shortage of insulin in the body, causing glucose to stay in the blood instead, which can cause a range of complications (Umcu, z.d.). Diabetes can be diagnosed by measuring the plasma glucose concentration in the blood (Diabetes Mellitus Type 2 \| LUMC, z.d.). To diagnose diabetes faster we want to know if we can predict glucose levels based on other parameters.
>>>>>>> Stashed changes

To see if this is possible we use a dataset about diabetes and we use the different parameters to verify whether we can predict glucose (Akturk & National Institute of Diabetes and Digestive and Kidney Diseases, 2020). The data is filtered on only females of at least 21 years of age from a Pima Indian heritage.

The different parameters in the dataset are:

-   Pregnancies: Number of times pregnant

-   Glucose: Plasma glucose concentration after 2 hours in an oral glucose tolerance test

-   BloodPressure: Diastolic blood pressure (mm Hg)

-   SkinThickness: Triceps skin fold thickness (mm)

-   Insulin: 2-Hour serum insulin (mu U/ml)

-   BMI: Body mass index (weight in kg/(height in m)\^2)

-   DiabetesPedigreeFunction: Diabetes pedigree function

-   Age: Age (years)

-   Outcome: Class variable (0 or 1, where 1 means positive for diabetes)

**Preprocessing**

To preprocess the data we categorized the BMI into four categories, being underweight, healthy, overweight and obese. We have kept all the data, because there were not many missing values or flukes in the data.

```{r}
#| warning: false
install.packages('car')
```

------------------------------------------------------------------------

**Initialization (Data loading and libraries)**

```{r}
<<<<<<< Updated upstream
#| warning: false

# Initialization
=======
>>>>>>> Stashed changes
setwd(".")
library(ggplot2)
library(car)
```

```{r}
#| warning: false

# Load .CSV and save as .RDS

datacsv <- read.csv("./data/raw/diabetes.csv", header = TRUE)
saveRDS(datacsv, "./data/raw/dataset.rds")

# Preprocessing
dataRDS <- readRDS("./data/raw/dataset.rds")
dataRDS <- na.omit(dataRDS) # removes NA from important columns
saveRDS(dataRDS, "./data/processed/dataset.rds")
dataset <- readRDS("./data/processed/dataset.rds")

# Recoding BMI to classes
dataRDS$BMI[dataRDS$BMI <= 18.5 ] <- 1
dataRDS$BMI[dataRDS$BMI > 18.5 & dataRDS$BMI <= 25  ] <- 2
dataRDS$BMI[dataRDS$BMI > 25 & dataRDS$BMI <= 30 ] <- 3
dataRDS$BMI[dataRDS$BMI > 30] <- 4

# Adding moderation
dataRDS$moderation <- dataRDS$BMI * dataRDS$Insulin * dataRDS$SkinThickness * (dataRDS$BloodPressure) 

summary(dataset)
```

```{r}
#| warning: false

dataRDS
for (i in 1:ncol(dataRDS)) {
  col_name <- colnames(dataRDS)[i]
  print(hist(dataRDS[, i],
       main = paste("Histogram of ", col_name),
       xlab = paste("Values of", col_name),
       col = "lightblue",
       border = "white"))
}
pairs(dataRDS)
```

**Exploring the dataset**

Above you can see multiple ways that our variables are described. They are represented in two ways: using histograms and using.a panel. In the histograms you can see which values are representative of each variable while in the panel you can see the relation between of each variable with each other variable. The histograms will be briefly discussed, however remaining discussion will focus only on the relevant plots from the panel which we use for regression.

-   **Pregnancies:** number of times pregnant, represented as an integer, values range between 0-14

-   **Glucose:** plasma glucose concentration in a toleration test represented as an integer, values range from 0-200.

-   **BloodPressure:** Bloodpressure represented as an integer with values in the range of 0-110.

-   **Skinthickness:** Thickness of the skin in millimetres, represented as an integer with values ranging from 0-60.

-   **Insulin:** ‚Äú2 hour serum insulin‚Äù with values ranging from 0-600.

-   **BMI:** BMI value represented as classification, namely: underweight=1, healthy=2, overweight=3 and obese=4. Most people in this study are obese.

-   **DiabetesPedigreeFunction:** Quantified genetic risk of diabetes. Risks range from 0-1,75.¬†

-   **Age:** Integer representing age, values range from 20-70.

-   **Outcome:** 0 or 1 value representing if someone has diabetes or not. Most participants don‚Äôt have diabetes.

-   **Moderation:** Product of the following values: BMI, Insulin, SkinThickness and BloodPressure. This value is added to support the regression accuracy.

**Building the model:**

```{r}
<<<<<<< Updated upstream
#| warning: false

=======
#Model with all data as predictor
>>>>>>> Stashed changes
model <- lm(Glucose ~ Age + Insulin + BMI + Pregnancies + BloodPressure + SkinThickness + DiabetesPedigreeFunction + moderation, 
             data = dataRDS)
# Model with significance values >0.05
model2 <- lm(Glucose ~ Age + Insulin + BMI + SkinThickness + moderation + DiabetesPedigreeFunction, 
             data = dataRDS)
# Model with significance values >0.01 and moderation
model3 <- lm(Glucose ~ Age + Insulin + BMI + SkinThickness + moderation, 
             data = dataRDS)

# Ask for summary statistics again
summary(model)
summary(model2)
summary(model3)

# Anova model to compare each model
anova(model, model2, model3)


# Plot with regression line for x1
ggplot(dataRDS, aes(x = Age, y = Glucose)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) + # se = FALSE to hide confidence interval
  labs(title = "Linear Relationship between Age and Glucose")

# Plot with regression line for x2
ggplot(dataRDS, aes(x = Insulin, y = Glucose)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "Linear Relationship between Insulin and Glucose")

# Plot with regression line for x1
ggplot(dataRDS, aes(x = SkinThickness, y = Glucose)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) + # se = FALSE to hide confidence interval
  labs(title = "Linear Relationship between Age and Glucose")

# Plot with regression line for x2
ggplot(dataRDS, aes(x = BMI, y = Glucose)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "Linear Relationship between BMI and Glucose")

# Plot with regression line for x2
ggplot(dataRDS, aes(x = moderation, y = Glucose)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "Linear Relationship between Moderation and Glucose")



```

<<<<<<< Updated upstream
```{r}
#| warning: false

# Assumptions are: linearity, Exogenous predictors, constant finite error variance, Predictor matrix full rank, independent errors, normal distributed errors.
=======
**Boxplots for each predictor and initialization for error calculations**
>>>>>>> Stashed changes

```{r}
# Boxplot for Age vs Glucose
ggplot(dataRDS, aes(x = factor(Age), y = Glucose)) +
  geom_boxplot() +
  labs(title = "Glucose Distribution by Age")

# Boxplot for Insulin vs Glucose
ggplot(dataRDS, aes(x = factor(Insulin), y = Glucose)) +
  geom_boxplot() +
  labs(title = "Glucose Distribution by Insulin Level")

# Boxplot for SkinThickness vs Glucose
ggplot(dataRDS, aes(x = factor(SkinThickness), y = Glucose)) +
  geom_boxplot() +
  labs(title = "Glucose Distribution by Skin Thickness")

# Boxplot for BMI vs Glucose
ggplot(dataRDS, aes(x = factor(BMI), y = Glucose)) +
  geom_boxplot() +
  labs(title = "Glucose Distribution by BMI")

# Boxplot for Moderation vs Glucose, moet maar over geargumenteerd worden
ggplot(dataRDS, aes(x = factor(moderation), y = Glucose)) +
  geom_boxplot() +
  labs(title = "Glucose Distribution by Moderation")

errors <- dataRDS$Glucose - predict(model3)
squared <- errors^2
MSE <- mean(squared)
vif(model3)
```

**Assumptions**

1.  Model is linear in the parameters: This holds for our values are static and non exponential as seen here:

```         
Intercept.     7.408e+01  
Age            6.592e-01  
Insulin        6.762e-02  
BMI            6.838e+00  
SkinThickness -3.211e-01  
moderation     3.965e-06
```

2.  Predictor model is full rank:

```{r}
#| warning: false
# turns model to matrix
X <- model.matrix(model3)

# Compares the rank to the amount of columns in the predictor matrix
qr(X)$rank == ncol(X)
```

3.  Predictors are strictly exogenous:
    -   i.e. the predictors do not corralate with the errors
4.  The errors have constant, finite variance
5.  Errors are uncorralated
6.  Errors are normally distributed

Assumptions 3-6 can be shown if:

$\varepsilon \stackrel{idd}{\sim} N(O,\sigma^2)$

```{r}
#| warning: false

# Check if the model is normally distributed
plot(model3, which = 2)
# shapiro test is significant so its normally distributed
shapiro.test(residuals(model))
# Histogram of error distribution
hist(errors,
       main = paste("Histogram of errors"),
       xlab = paste("error values"))

#residuals plot
plot(fitted(model3), resid(model3)) + abline(h=0, col="pink")

```

\
\
For the assumptions of the linear regression we checked for linearity, normal distribution, homoscedasticity, multicollinearity, and outliers. We checked for linearity ... . Normal distribution was found in both a K-S test (...) and through the use of a histogram, which showed a nice curve with perhaps the tiniest skewing on the left side. Homoscedasticity was assessed and confirmed by plotting the predicted values against the residuals, with no clear funnel or other deviant pattern being observed. Multicollinearity was checked through VIF tests (...). Lastly, there were x outliers found.

**Discussing the model**

```{r}
#| warning: false

summary(model3)
```

A multiple linear regression was conducted to examine the predictors for glucose levels. This was done through the use of age, insulin, BMI, skin thickness, and a moderation variable. The overall model was significant (F(5, 762) = 44.13, p \> .001) and explains 22,5% of the variance in glucose (R¬≤ = .2245). Age has a positive effect on glucose levels where older individuals have a higher glucose level (ùõΩ = .66, p \< .001). The same is true for both insulin levels (ùõΩ = .068, p \< .001 and BMI (ùõΩ = 6.84, p \< .001). Skin thickness however has a negative effect, thus participants with a thicker skin showed lower levels of glucose (ùõΩ = -.32, p \< .001). The moderation effect is significant as well (ùõΩ = 3.965e-06, p \< .047). However, the effect size is so small that it can be considered negligible. Overall, the results suggest that age, insulin, BMI, and skin thickness contribute meaningfully to glucose level variation.

In model 3, an ANOVA was done to look at the level of prediction of age, insulin, BMI, and skin thickness on glucose levels, and whether this association was influenced by the moderation term. The model shows that the interaction term significantly influences the relationship between the predictors and glucose levels (F(1, 762) = 4.91, p \> .027). This means that the relationship between one of the predictors and glucose levels differs depending on the level of the moderator.

**Conclusion**

For our research, we wanted to answer the question if we can predict glucose levels on the basis of several predictors and a moderation. The results indicate that age, insulin levels and BMI have a positive relation with glucose: as these factors increase, glucose levels will increase with. Skin thickness, however, has a negative effect, meaning that individuals with thinner skin tend to have higher glucose levels. Although the moderator had an effect, this effect was small to such an extend that it is unlikely it will have any meaningful practical impact.

Overall, the findings suggest that glucose levels can be understood through the different predictors included in the model, while the moderator does not contribute in a meaningful way.

**References**

Cijfers over diabetes. (n.d.). diabetes.nl. https://www.diabetes.nl/wat-is-diabetes/over-diabetes/cijfers- over-diabetes

Diabetes Mellitus type 2 \| LUMC. (n.d.). https://www.lumc.nl/afdelingen/endocrinologie/ziektes-en-aandoeningen/diabetes-mellitus-type-2/

Umcu. (n.d.). Diabetes. UMC Utrecht. https://www.umcutrecht.nl/nl/ziekte/diabetes

Akturk, M. & National Institute of Diabetes and Digestive and Kidney Diseases. (2020). Diabetes \[Dataset\]. https://www.kaggle.com/datasets/mathchi/diabetes-data-set
