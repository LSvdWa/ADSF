---
title: "Predicting Diabetes"
authors:
- Demi van den Biggelaar (9660089)
- "August Gesthuizen (5292565)"
- "Friso Harff (7526946)"
- "Leander van der Waal (7180063)"
date: "2026-01-15"
format:
  html:
    embed-resources: true
---

# **Prediction of glucose using linear regression**

Demi van den Biggelaar (9660089)\
August Gesthuizen (5292565)\
Friso Harff (7526946)\
Leander van der Waal (7180063)\

## **Introduction**

1 in 14 Dutch citizens has diabetes (Cijfers Over Diabetes, z.d.). To treat diabetes more effectively and to prevent serious complications it is crucial to diagnose it as early as possible. Having diabetes means that there is a shortage of insulin in the body, causing glucose to stay in the blood instead, which can cause a range of complications (Umcu, z.d.).

We want to see if we can predict whether someone has diabetes using logistic regression.

To see if this is possible we use a dataset about diabetes and we use the different parameters to verify whether we can predict diabetes (Akturk & National Institute of Diabetes and Digestive and Kidney Diseases, 2020). The dataset is filtered on only females of at least 21 years of age from a Pima Indian heritage.

The different parameters in the dataset are:

-   Pregnancies: Number of times pregnant

-   Glucose: Plasma glucose concentration after 2 hours in an oral glucose tolerance test

-   BloodPressure: Diastolic blood pressure (mm Hg)

-   SkinThickness: Triceps skin fold thickness (mm)

-   Insulin: 2-Hour serum insulin (mu U/ml)

-   BMI: Body mass index (weight in kg/(height in m)\^2)

-   DiabetesPedigreeFunction: Diabetes pedigree function

-   Age: Age (years)

-   Outcome: Class variable (0 or 1, where 1 means positive for diabetes)

## **Preprocessing & Loading data**

To preprocess the data we categorized the BMI into four categories, being underweight, healthy, overweight and obese. We also remove entries where we see that values are clearly skewed, for example a BMI of 0 should not exist.

------------------------------------------------------------------------

```{r}
# Initialization
setwd(".")
library(ggplot2)
```

```{r}
#| warning: false

# Load .CSV and save as .RDS

datacsv <- read.csv("./data/raw/diabetes.csv", header = TRUE)
saveRDS(datacsv, "./data/raw/dataset.rds")

# Preprocessing
dataRDS <- readRDS("./data/raw/dataset.rds")
dataRDS <- na.omit(dataRDS) # removes NA from important columns
saveRDS(dataRDS, "./data/processed/dataset.rds")
dataset <- readRDS("./data/processed/dataset.rds")

# Recoding BMI to classes
dataRDS$BMI[dataRDS$BMI <= 18.5 ] <- 1                     # Underweight
dataRDS$BMI[dataRDS$BMI > 18.5 & dataRDS$BMI <= 25  ] <- 2 # Healthy
dataRDS$BMI[dataRDS$BMI > 25 & dataRDS$BMI <= 30 ] <- 3    # Overweight
dataRDS$BMI[dataRDS$BMI > 30] <- 4                         # Obese

# Removing missing values
dataRDS <- subset(dataRDS,
                     BloodPressure != 0 &
                     SkinThickness != 0 &
                     Glucose != 0 &
                     Insulin != 0 &
                     BMI != 0)

# Adding moderation
dataRDS$moderation <- dataRDS$BMI * dataRDS$Insulin * dataRDS$SkinThickness * dataRDS$BloodPressure 

summary(dataset)
```

## **Exploring the data**

```{r}
#| warning: false

dataRDS
for (i in 1:ncol(dataRDS)) {
  col_name <- colnames(dataRDS)[i]
  print(hist(dataRDS[, i],
       main = paste("Histogram of ", col_name),
       xlab = paste("Values of", col_name),
       col = "lightblue",
       border = "white"))
}
pairs(dataRDS)
```

Above you can see multiple ways that our variables are described. They are represented in two ways: using histograms and using.a panel. In the histograms you can see which values are representative of each variable while in the panel you can see the relation between of each variable with each other variable. The histograms will be briefly discussed, however remaining discussion will focus only on the relevant plots from the panel which we use for regression.

-   **Pregnancies:** number of times pregnant, represented as an integer, values range between 0-14

-   **Glucose:** plasma glucose concentration in a toleration test represented as an integer, values range from 56-198.

-   **BloodPressure:** Bloodpressure represented as an integer with values in the range of 24-110.

-   **Skinthickness:** Thickness of the skin in millimetres, represented as an integer with values ranging from 7-63.

-   **Insulin:** â€œ2 hour serum insulinâ€ with values ranging from 14-846.

-   **BMI:** BMI value represented as classification, namely: underweight=1, healthy=2, overweight=3 and obese=4. Most people in this study are considered to be obese.

-   **DiabetesPedigreeFunction:** Quantified genetic risk of diabetes. Risks range from 0-1,75.Â 

-   **Age:** Integer representing age, values range from 20-70.

-   **Outcome:** 0 or 1 value representing if someone has diabetes or not. Most participants donâ€™t have diabetes.

-   **Moderation:** Product of the following values: BMI, Insulin, SkinThickness and BloodPressure. This value is added to support the regression accuracy.

## **Building the model**

```{r}
fit0 <- glm(Outcome ~ Age + Pregnancies + Glucose + BloodPressure + SkinThickness + Insulin + BMI + DiabetesPedigreeFunction + moderation,  
            data = dataRDS)

fit1 <- glm(Outcome ~ Age + Glucose + BMI + DiabetesPedigreeFunction,  
            data = dataRDS)

fit2 <- glm(Outcome ~ Age + Glucose + BMI + DiabetesPedigreeFunction + Glucose*BMI,  
            data = dataRDS)

fit3 <- glm(Outcome ~ Glucose + BMI + DiabetesPedigreeFunction,  
            data = dataRDS)

fit4 <- glm(Outcome ~ Glucose + BMI,  
            data = dataRDS)
AIC(fit0)
BIC(fit0)
AIC(fit1)
BIC(fit1)

#2 is best
AIC(fit2)
BIC(fit2)
summary(fit2)

AIC(fit3)
BIC(fit3)
AIC(fit4)
BIC(fit4)

```

## **Assumptions**

```{r}
# assumptions

```

(Intercept) -1.127e+00

Age 8.326e-03

Glucose 6.076e-03 BMI 1.044e-01

DiabetesPedigreeFunction 1.623e-01

moderation 9.596e-10

```{r}
# turns model to matrix
X <- model.matrix(fit2)

# Compares the rank to the amount of columns in the predictor matrix
# if True, the predictor matrix is full rank
qr(X)$rank == ncol(X)

## **Exploring the model**
```

```{r}
# Binomial 1: Outcome is binary
levels(factor(dataRDS$Outcome))

# Binomial 2:Linear predictor can explain all the systematic trends in ðœ‹
# no resudiual clustering after accounting for X
ICC::ICCbare(x = dataRDS$Outcome, y = resid(fit2, type = "deviance"))
# No important variables omitted from X
```

We must also satisfy three computational requirements that were not necessary in linear regression.

The sample size is large enough to support numerical estimation.

The outcome classes are suï¬ƒciently balanced.

There is no perfect prediction.

remove outlier:

```{r}
plot(fit2, 4)

cooks <- cooks.distance(fit2)
cutoff <- 10 / nrow(dataRDS)
outliers <- which(cooks > cutoff)

dataRDS[outliers,]

dataRDS <- dataRDS[-outliers,]

fit2 <- glm(Outcome ~ Age + Glucose + BMI + DiabetesPedigreeFunction,  
            data = dataRDS)
plot(fit2, 4)
```

Exploring the model

```{r}
nullFit <- glm(Outcome ~ 1, family = binomial, data = dataRDS)
## Test the fit of our example model:
anova(nullFit, fit2, test = "Chisq")

car::vif(fit2) # shows no big multicolinearity
plot(fit2)
plot(fit2, 4)


car::crPlots(fit2, "Glucose")
dfbetas(fit2)[ , "Glucose"] |> plot()

# read performance
library(dplyr)
## Add predictions to the dataset:
dataRDS <- dataRDS %>%
  mutate(
    piHat = predict(fit2, type = "response"),  # predicted probabilities
    yHat  = factor(ifelse(piHat > 0.5, 1, 0), levels = c(0, 1))
  )

# Make levels the same
dataRDS$y <- factor(dataRDS$y, levels = c(0, 1))

library(caret)
cMat <- confusionMatrix(
  data = dataRDS$yHat,
  reference = dataRDS$y
)

cMat$table
cMat$byClass

# ROC Curve
rocData <- dataRDS %>%
pROC::roc(Outcome, piHat)
plot(rocData)

#CEE for comparison good models
```

## **Conclusion**

Cijfers over diabetes. (n.d.). diabetes.nl. https://www.diabetes.nl/wat-is-diabetes/over-diabetes/cijfers- over-diabetes

Umcu. (n.d.). Diabetes. UMC Utrecht. https://www.umcutrecht.nl/nl/ziekte/diabetes

Akturk, M. & National Institute of Diabetes and Digestive and Kidney Diseases. (2020). Diabetes \[Dataset\]. https://www.kaggle.com/datasets/mathchi/diabetes-data-set
