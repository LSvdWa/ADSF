---
title: "Predicting Diabetes"
authors:
- Demi van den Biggelaar (9660089)
- "August Gesthuizen (5292565)"
- "Friso Harff (7526946)"
- "Leander van der Waal (7180063)"
date: "2026-01-15"
format:
  revealjs:
    embed-resources: true
    theme: dracula
    slide-number: true
    transition: fade
---

```{r}
#| warning: false
# Initialization
setwd(".")
library(dplyr)
library(ggplot2)
library(magrittr)
library(kableExtra)
library(pROC)
library(regclass)
library(caret)
library(GGally)

```

## Inhoudsopgave - Leander

-   Research Question
-   The Data
-   Models
-   The Best Model
-   Assumptions
-   Conclusion model
-   Answer Research Question

## Introduction Research Question

-   Diabetes

-   Common

-   Diagnosis

## The Research Question

Can we predict if someone is diabetic using research data with a logistic regression using Age, Glucose, BMI en DiabetesPedigreeFunction?

## The Dataset

![](images/clipboard-739077630.png)

National Institute of Diabetes and Digestive and Kidney Diseases (1990)

## Exploring the data

-   Pregnancies: Number of times pregnant

-   Glucose: Plasma glucose concentration a 2 hours in an oral glucose tolerance test

-   BloodPressure: Diastolic blood pressure (mm Hg)

-   SkinThickness: Triceps skin fold thickness (mm)

-   Insulin: 2-Hour serum insulin (mu U/ml)

-   BMI: Body mass index (weight in kg/(height in m)\^2)

-   DiabetesPedigreeFunction: a function that scores the probability of diabetes based on family history, with a realistic range of 0.08 to 2.42

-   Age: Age (years)

-   Outcome: Class variable (0 or 1)

## Preprocessing

```{r}
dataRDS <- readRDS("./data/raw/dataset.rds")
dataRDS <- na.omit(dataRDS) # removes NA from important columns
saveRDS(dataRDS, "./data/processed/dataset.rds")
dataset <- readRDS("./data/processed/dataset.rds")
```

```{r}
#| echo: true
#| output: false
#| code-line-numbers: true
#| code-fold: false

# Recoding BMI to classes
dataRDS$BMI[dataRDS$BMI <= 18.5 ] <- 1                     # Underweight
dataRDS$BMI[dataRDS$BMI > 18.5 & dataRDS$BMI <= 25  ] <- 2 # Healthy
dataRDS$BMI[dataRDS$BMI > 25 & dataRDS$BMI <= 30 ] <- 3    # Overweight
dataRDS$BMI[dataRDS$BMI > 30] <- 4                         # Obese

# Removing missing values
dataRDS <- subset(dataRDS,
                     BloodPressure != 0 &
                     SkinThickness != 0 &
                     Glucose != 0 &
                     Insulin != 0 &
                     BMI != 0)
```

## Interesting Finds

```{r}
#| warning: false

for (i in 1:1) {
  col_name <- colnames(dataRDS)[i]
  hist(dataRDS[, i],
       main = paste("Histogram of ", col_name),
       xlab = paste("Values of", col_name),
       col = "pink",
       border = "white")
}
```

## 

```{r}
for (i in 2:2) {
  col_name <- colnames(dataRDS)[i]
  hist(dataRDS[, i],
       main = paste("Histogram of ", col_name),
       xlab = paste("Values of", col_name),
       col = "green",
       border = "white")
}
```

## 

```{r}
for (i in 3:3) {
  col_name <- colnames(dataRDS)[i]
  hist(dataRDS[, i],
       main = paste("Histogram of ", col_name),
       xlab = paste("Values of", col_name),
       col = "red",
       border = "white")
}
```

## 

```{r}
for (i in 4:4) {
  col_name <- colnames(dataRDS)[i]
  hist(dataRDS[, i],
       main = paste("Histogram of ", col_name),
       xlab = paste("Values of", col_name),
       col = "beige",
       border = "white")
}
```

## 

```{r}
for (i in 5:5) {
  col_name <- colnames(dataRDS)[i]
  hist(dataRDS[, i],
       main = paste("Histogram of ", col_name),
       xlab = paste("Values of", col_name),
       col = "lightblue",
       border = "white")
}
```

## 

```{r}
for (i in 6:6) {
  col_name <- colnames(dataRDS)[i]
  hist(dataRDS[, i],
       main = paste("Histogram of ", col_name),
       xlab = paste("Values of", col_name),
       col = "orange",
       border = "white")
}
```

259/393 = 66% are obese

## 

```{r}
#| warning: false
for (i in 7:7) {
  col_name <- colnames(dataRDS)[i]
  hist(dataRDS[, i],
       main = paste("Histogram of ", col_name),
       xlab = paste("Values of", col_name),
       col = "lightblue",
       border = "white")
}

```

## 

```{r}
for (i in 8:8) {
  col_name <- colnames(dataRDS)[i]
  hist(dataRDS[, i],
       main = paste("Histogram of ", col_name),
       xlab = paste("Values of", col_name),
       col = "black",
       border = "white")
}

```

## 

```{r}
#| warning: false
for (i in 9:9) {
  col_name <- colnames(dataRDS)[i]
  hist(dataRDS[, i],
       main = paste("Histogram of ", col_name),
       xlab = paste("Values of", col_name),
       col = "lightblue",
       border = "white")
}
```

## 

```{r}
#| warning: false
ggpairs(dataRDS)

```

## Beste model kiezen en uitleggen (leg uit wat het beste model is, wat het doet en waarom het het beste is) - August

When you click the **Render** button a presentation will be generated that includes both content and the output of embedded code. You can embed code like this:\
#########VERGEET NIET DE MODERATIES TE BENOEMEN EN KOPPEL HET MISSCHIEN TERUG AAN DE PAIRS TABEL HIERBOVEN, OOK KAN JE ZELF ALTIJD MODELLEN AANPASSEN OM HET VERHAAL BETER TE MAKEN###########

```{r}
NulFit <- glm(Outcome ~ 1,  
            family = binomial,
            data = dataRDS)

fit0 <- glm(Outcome ~ Age + Pregnancies + Glucose + BloodPressure + SkinThickness + Insulin + BMI + DiabetesPedigreeFunction,  
            family = binomial,
            data = dataRDS)

fit1 <- glm(Outcome ~ Age + Glucose + BMI + DiabetesPedigreeFunction,  
            family = binomial,
            data = dataRDS)

fit2 <- glm(Outcome ~ Age + Glucose + BMI + DiabetesPedigreeFunction + Glucose*BMI,
            family = binomial,
            data = dataRDS)

fit3 <- glm(Outcome ~ Glucose + BMI + DiabetesPedigreeFunction, 
            family = binomial,
            data = dataRDS)

fit4 <- glm(Outcome ~ Glucose + BMI,
            family = binomial,
            data = dataRDS)

fit33 <- glm(Outcome ~ Glucose + BMI + DiabetesPedigreeFunction + Age*Pregnancies, 
            family = binomial,
            data = dataRDS)

anova(NulFit, fit1)
```

## Binary dependent variable

-   Diabetes (coded 1)
-   Not diabetes (coded 0)

```{r }
# Mutating Outcome into factor (necessary for next part)
dataRDS$Outcome <- as.factor(dataRDS$Outcome)

dataRDS %>% 
  ggplot(aes(x = Outcome, fill = Outcome)) +
  geom_bar() +
  labs(x = "Outcome",
       y = "Count",
       title = "Distribution of the Outcome variable") +
  theme_bw()
# You can see that there are indeed only two outcomes for `Outcome`, so our outcome follows a binomial distribution.
```

## Sufficiently large sample size

-   10 cases per candidate predictor : $N=\frac{10k}{p}$

```{r}
#First we need to get the proportion of people that have diabetes in our sample, which is 0.33

dataRDS %>% 
  count(Outcome) %>% 
  mutate(prop = n / sum(n))
```

-   k=4, p=0.33 -\> 121 required

-   130 positive

## Full-rank predictor matrix

-   More observations than predictors

-   No multicollinearity among linear predictors

```{r}
VIF(fit1)
```

-   VIF=1 : no correlation

## Continuous predictors are linearly related to the $logit(\pi)$

-   Continuous predictors : `Age`, Glucose and DiabetesPedigreeFunction

```{r}
dataRDS$logit <- predict(fit2, type="link")  

dataRDS %>%   
  ggplot(aes(Age, logit)) +
  geom_point(size = 0.5, alpha = 0.5) +
  geom_smooth(method = "glm") +
  theme_bw()
```

## Continuous predictors are linearly related to the $logit(\pi)$

-   Continuous predictors : Age, `Glucose` and DiabetesPedigreeFunction

```{r}
dataRDS$logit <- predict(fit2, type="link")  

dataRDS %>%   
  ggplot(aes(Glucose, logit)) +
  geom_point(size = 0.5, alpha = 0.5) +
  geom_smooth(method = "glm") +
  theme_bw()
```

## Continuous predictors are linearly related to the $logit(\pi)$

-   Continuous predictors : Age, Glucose and `DiabetesPedigreeFunction`

```{r}
dataRDS$logit <- predict(fit2, type="link")  

dataRDS %>%   
  ggplot(aes(DiabetesPedigreeFunction, logit)) +
  geom_point(size = 0.5, alpha = 0.5) +
  geom_smooth(method = "glm") +
  theme_bw()
```

## No influential values or outliers

```{r}
plot(fit1, 5)
```

-   No values outside Cook's distance

-   Maybe influential observations?

## Most influential observations

```{r}
mostInf <- which(cooks.distance(fit1) > 0.04823)
dataRDS[mostInf, c("Glucose", "Age", "BMI", "DiabetesPedigreeFunction")]
```

## Removing most influential observations

```{r}
dataRDS2 <- dataRDS[-mostInf, ]
fit1Altered <- update(fit1, data = dataRDS2)
data.frame(
  Model = c("fit1", "fit1Altered"),
  Null_Deviance = round(c(fit1$null.deviance, fit1Altered$null.deviance), 3),
  Residual_Deviance = round(c(fit1$deviance, fit1Altered$deviance), 3),
  AIC = round(c(fit1$aic, fit1Altered$aic), 2)
)
```

## Coefficients

-   

```{r }
summary(fit1)$coefficients
```

## Odds ratios

- 

```{r}
exp(coef(fit1))
```

## Concludeer en beantwoord - Demi

When you click the **Render** button a presentation will be generated that includes both content and the output of embedded code. You can embed code like this:

```{r }
1 + 1
```
