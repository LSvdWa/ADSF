---
title: "Predicting Diabetes"
authors:
- Demi van den Biggelaar (9660089)
- "August Gesthuizen (5292565)"
- "Friso Harff (7526946)"
- "Leander van der Waal (7180063)"
date: "2026-01-15"
format:
  html:
    embed-resources: true
---

```{r}
#| warning: false
# Initialization
setwd(".")
library(dplyr)
library(ggplot2)
library(magrittr)
library(kableExtra)
library(pROC)
library(regclass)
library(caret)

```

## Inhoudsopgave - Leander

-   De data
-   Onze research vraag
-   Modellen
-   Het beste model
-   Assumpties
-   Conclusie model
-   Antwoord research vraag

## De Dataset

![](images/clipboard-739077630.png)

National Institute of Diabetes and Digestive and Kidney Diseases (1990)

## Data uitleggen - Leander

-   Pregnancies: Number of times pregnant

-   Glucose: Plasma glucose concentration a 2 hours in an oral glucose tolerance test

-   BloodPressure: Diastolic blood pressure (mm Hg)

-   SkinThickness: Triceps skin fold thickness (mm)

-   Insulin: 2-Hour serum insulin (mu U/ml)

-   BMI: Body mass index (weight in kg/(height in m)\^2)

-   DiabetesPedigreeFunction: Diabetes pedigree function

-   Age: Age (years)

-   Outcome: Class variable (0 or 1)

## Inlezen data Leander

```{r}
datacsv <- read.csv("./data/raw/diabetes.csv", header = TRUE)
saveRDS(datacsv, "./data/raw/dataset.rds")

# Preprocessing
dataRDS <- readRDS("./data/raw/dataset.rds")
dataRDS <- na.omit(dataRDS) # removes NA from important columns
saveRDS(dataRDS, "./data/processed/dataset.rds")
dataset <- readRDS("./data/processed/dataset.rds")

# Recoding BMI to classes, WAAROM OOKALWEER??
dataRDS$BMI[dataRDS$BMI <= 18.5 ] <- 1                     # Underweight
dataRDS$BMI[dataRDS$BMI > 18.5 & dataRDS$BMI <= 25  ] <- 2 # Healthy
dataRDS$BMI[dataRDS$BMI > 25 & dataRDS$BMI <= 30 ] <- 3    # Overweight
dataRDS$BMI[dataRDS$BMI > 30] <- 4                         # Obese

# Removing missing values
dataRDS <- subset(dataRDS,
                     BloodPressure != 0 &
                     SkinThickness != 0 &
                     Glucose != 0 &
                     Insulin != 0 &
                     BMI != 0)
```

## Interessante bevindingen - Leander

```{r}
#| warning: false

for (i in 1:ncol(dataRDS)) {
  col_name <- colnames(dataRDS)[i]
  hist(dataRDS[, i],
       main = paste("Histogram of ", col_name),
       xlab = paste("Values of", col_name),
       col = "lightblue",
       border = "white")
}
pairs(dataRDS)
```

## Research Questions - Leander

Can we predict if someone is diabetic using the previously stated variables with a logistic regression?

## Beste model kiezen en uitleggen (leg uit wat het beste model is, wat het doet en waarom het het beste is) - August

When you click the **Render** button a presentation will be generated that includes both content and the output of embedded code. You can embed code like this:\
#########VERGEET NIET DE MODERATIES TE BENOEMEN EN KOPPEL HET MISSCHIEN TERUG AAN DE PAIRS TABEL HIERBOVEN, OOK KAN JE ZELF ALTIJD MODELLEN AANPASSEN OM HET VERHAAL BETER TE MAKEN###########

```{r}
fit0 <- glm(Outcome ~ Age + Pregnancies + Glucose + BloodPressure + SkinThickness + Insulin + BMI + DiabetesPedigreeFunction,  
            family = binomial,
            data = dataRDS)

fit1 <- glm(Outcome ~ Age + Glucose + BMI + DiabetesPedigreeFunction,  
            family = binomial,
            data = dataRDS)

fit2 <- glm(Outcome ~ Age + Glucose + BMI + DiabetesPedigreeFunction + Glucose*BMI,
            family = binomial,
            data = dataRDS)

fit3 <- glm(Outcome ~ Glucose + BMI + DiabetesPedigreeFunction, 
            family = binomial,
            data = dataRDS)

fit4 <- glm(Outcome ~ Glucose + BMI,
            family = binomial,
            data = dataRDS)
```

## assumptions, welke assumptions, waarom ze voldoen - Friso

## Binary dependent variable

-   Diabetes (coded 1)
-   Not diabetes (coded 0)

```{r }
# Mutating Outcome into factor (necessary for next part)
dataRDS$Outcome <- as.factor(dataRDS$Outcome)

dataRDS %>% 
  ggplot(aes(x = Outcome, fill = Outcome)) +
  geom_bar() +
  labs(x = "Outcome",
       y = "Count",
       title = "Distribution of the Outcome variable") +
  theme_bw()
# You can see that there are indeed only two outcomes for `Outcome`, so our outcome follows a binomial distribution.
```

## Sufficiently large sample size

-   10 cases per candidate predictor : $N=\frac{10k}{p}$

```{r}
#First we need to get the proportion of people that have diabetes in our sample, which is 0.33

dataRDS %>% 
  count(Outcome) %>% 
  mutate(prop = n / sum(n))
```

```{r}
#Now we can plug this into our formula to get the minimum number of positive cases. 
ssize_cal <- function(k, p){
  round((10*k)/p)
}

ssize_cal(2, 0.33)
```

## Full-rank predictor matrix

-   More observations than predictors

-   No multicollinearity among linear predictors

```{r}
VIF(fit1)
```

## assumptions, delete outliers, laat zien dat ie niet van belang is op case by case basis - Friso

When you click the **Render** button a presentation will be generated that includes both content and the output of embedded code. You can embed code like this:

```{r }
1 + 1
```

## Exploring the model section, ga in op het model met onderzoeksmethode uit slides INCLUDING CONFUSION MATRIX - Demi

When you click the **Render** button a presentation will be generated that includes both content and the output of embedded code. You can embed code like this:

```{r }
1 + 1
```

## Concludeer en beantwoord - Demi

When you click the **Render** button a presentation will be generated that includes both content and the output of embedded code. You can embed code like this:

```{r }
1 + 1
```
